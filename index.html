<!doctype html> 

<html lang="th"> 

<head> 

<meta charset="utf-8" /> 

<meta name="viewport" content="width=device-width, initial-scale=1" /> 

<title>S.E.A.N.G • ProPlugin (Surface/On-wall & Ceiling Quality Levels + Dynamic Tap)</title> 

<style> 

:root { --gap:12px; --font: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", sans-serif; } 

html,body{height:100%} 

body{margin:0; font-family:var(--font); background:#0f172a; color:#e2e8f0;} 

header{padding:16px 20px; border-bottom:1px solid #334155; display:flex; align-items:center; gap:12px;} 

header h1{font-size:18px; margin:0;} 

main{display:grid; grid-template-columns: 460px 1fr; gap:20px; padding:20px;} 

fieldset{border:1px solid #334155; border-radius:10px; padding:14px; margin:0 0 16px 0;} 

legend{padding:0 6px; color:#93c5fd;} 

label{display:block; font-size:13px; margin:10px 0 4px;} 

input, select{width:100%; padding:10px; border:1px solid #475569; border-radius:8px; background:#0b1220; color:#e2e8f0;} 

.row{display:grid; grid-template-columns:1fr 1fr; gap:10px;} 

button{padding:12px 14px; border:0; border-radius:10px; background:#2563eb; color:#fff; font-weight:600; cursor:pointer;} 

button.secondary{background:#1f2937} 

.panel{background:#0b1220; border:1px solid #334155; border-radius:12px; padding:12px;} 

#canvas{width:100%; height:580px; background:#020617; border:1px solid #334155; border-radius:12px;} 

.kpi{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-top:12px} 

.kpi div{background:#0b1220; border:1px solid #334155; border-radius:10px; padding:10px;} 

.kpi .label{font-size:12px; color:#93a1b2;} 

.kpi .value{font-size:18px; font-weight:700;} 

.note{font-size:12px; color:#93a1b2; margin-top:6px} 

.err{margin-top:10px; padding:10px; border:1px solid #7f1d1d; background:#450a0a; color:#fecaca; border-radius:10px; display:none} 

@media (max-width: 1180px){ .kpi{grid-template-columns:repeat(2,1fr)} } 

@media (max-width: 1024px){ main{grid-template-columns:1fr} } 

</style> 

</head> 

<body> 

<header> 

  <h1>S.E.A.N.G (Simple Estimator for Audio Network Grid)</h1> 

  <div style="margin-left:auto; font-size:12px;opacity:.75">ProPlugin • Surface/On-wall & Ceiling Levels</div> 

</header> 

 

<main> 

  <section> 

    <form id="form"> 

      <fieldset> 

        <legend>หน่วย & ขนาดห้อง</legend> 

        <div class="row"> 

          <div> 

            <label>หน่วย (Units)</label> 

            <select id="units"><option value="m">เมตร (m)</option><option value="ft">ฟุต (ft)</option></select> 

          </div> 

          <div> 

            <label>เลย์เอาต์กริด (ใช้กับ Ceiling)</label> 

            <select id="layout"><option value="square">Square</option><option value="hex">Hex</option></select> 

          </div> 

        </div> 

        <div class="row"> 

          <div><label>กว้าง (Width)</label><input type="text" id="roomW" value="12"></div> 

          <div><label>ยาว (Length)</label><input type="text" id="roomL" value="18"></div> 

        </div> 

        <div class="row"> 

          <div><label>สูงเพดาน (Ceiling)</label><input type="text" id="roomH" value="3.2"></div> 

          <div> 

            <label>ความสูงผู้ฟัง</label> 

            <select id="listenerPreset"> 

              <option value="standing">ยืน (1.5 m)</option> 

              <option value="seated" selected>นั่ง (1.2 m)</option> 

              <option value="custom">กำหนดเอง</option> 

            </select> 

          </div> 

        </div> 

        <div class="row" id="listenerCustomRow" style="display:none"> 

          <div><label>Listener Height</label><input type="text" id="listenerH" value="1.2"></div> 

        </div> 

      </fieldset> 

 

      <fieldset> 

        <legend>แบรนด์ / รุ่น</legend> 

        <div class="row"> 

          <div> 

            <label>แบรนด์</label> 

            <select id="brand"> 

              <option value="">— เลือกแบรนด์ —</option> 

              <option value="optimal">Optimal Audio</option> 

              <option value="hh">HH</option> 

            </select> 

          </div> 

          <div> 

            <label>รุ่น (Preset)</label> 

            <select id="model"><option value="">— เลือกรุ่น —</option></select> 

          </div> 

        </div> 

        <div class="note">เลือกแบรนด์/รุ่น → ระบบจะตั้งค่าชนิด/มุมครอบคลุม/ความไว และ <b>ชุด Tap</b> ของรุ่นนั้นให้อัตโนมัติ</div> 

      </fieldset> 

 

      <fieldset> 

        <legend>พารามิเตอร์ลำโพง</legend> 

        <div class="row"> 

          <div> 

            <label>ชนิดลำโพง</label> 

            <select id="spkType"> 

              <option value="ceiling">Ceiling</option> 

              <option value="pendant">Pendant</option> 

              <option value="surface">Surface-mount / On-wall</option> 

            </select> 

          </div> 

          <div> 

            <label>ระดับคุณภาพเสียง (เฉพาะ Ceiling)</label> 

            <select id="quality"> 

              <option value="high" selected>สูง (start=H/2, step=H)</option> 

              <option value="mid">ปานกลาง (start=H, step=1.5H)</option> 

              <option value="low">ต่ำ/budget (start=H, step=2H)</option> 

            </select> 

          </div> 

        </div> 

 

        <div class="row"> 

          <div><label>มุมครอบคลุม (°)</label><input type="text" id="coverage" value="120"></div> 

          <div><label>Sensitivity (dB @1W/1m)</label><input type="text" id="sens" value="88"></div> 

        </div> 

 

        <div class="row"> 

          <div> 

            <label>Tap 70V/100V (เฉพาะรุ่น)</label> 

            <select id="tapSelect"> 

              <option value="auto" selected>Auto (แนะนำจากรุ่นนี้)</option> 

            </select> 

          </div> 

          <div></div> 

        </div> 

 

        <div class="row" id="tapCustomRow" style="display:none"> 

          <div><label>Custom Tap (คอมมาแยก ถ้ารุ่นไม่ระบุ)</label><input type="text" id="tapCustom" placeholder="เช่น 2,4,8,16"></div> 

          <div></div> 

        </div> 

      </fieldset> 

 

      <div class="row"> 

        <button type="button" id="calcBtn">คำนวณ</button> 

        <button type="button" class="secondary" id="clearBtn">ล้างค่า</button> 

      </div> 

      <div class="err" id="err"></div> 

    </form> 

  </section> 

 

  <section class="panel"> 

    <canvas id="canvas"></canvas> 

    <div class="kpi"> 

      <div><div class="label">จำนวนลำโพง</div><div class="value" id="kCount">-</div></div> 

      <div><div class="label">ระยะวาง (C–C)</div><div class="value" id="kSpacing">-</div></div> 

      <div><div class="label">Tap แนะนำ/ที่เลือก</div><div class="value" id="kTap">-</div></div> 

      <div><div class="label">รวมโหลด (W)</div><div class="value" id="kTotalW">-</div></div> 

    </div> 

    <div id="summary" style="margin-top:12px;font-size:13px"></div> 

    <div id="ampBox" style="margin-top:8px; font-size:13px; padding:10px; border:1px solid #334155; border-radius:10px;"> 

      <div style="opacity:.9">กำลังแอมป์ที่แนะนำ (เผื่อ headroom): <b id="kAmpRec">-</b></div> 

      <div style="opacity:.7; margin-top:4px">เกณฑ์: รวมโหลด × <span id="kHeadroomPct">1.25×</span> ปัดขึ้นเป็นขนาดมาตรฐานใกล้สุด</div> 

    </div> 

  </section> 

</main> 

 

<script> 

// ========= helpers ========= 

const $=id=>document.getElementById(id); 

const toRad=deg=>deg*Math.PI/180; 

function sanitizeNum(v){v=String(v??'').replace(',', '.').replace(/[^\d\.\-]/g,'');const n=parseFloat(v);return isNaN(n)?null:n;} 

function fmt(v,u){return(u==='m')?v.toFixed(2)+' m':(v*3.28084).toFixed(2)+' ft';} 

function fromUnits(v,u){return(u==='m')?v:v/3.28084;} 

function nearestTap(p,taps){if(!taps||!taps.length||!isFinite(p)||p<=0) return null;let best=taps[0],d=Math.abs(taps[0]-p);for(const t of taps){const dd=Math.abs(t-p);if(dd<d){d=dd;best=t;}}for(const t of taps){if(t>=p) return t;}return best;} 

function showErr(m){$('err').style.display='block';$('err').textContent=m;} 

function clearErr(){$('err').style.display='none';} 

const HEADROOM = 1.25; // 25% headroom 

const AMP_STEPS = [30, 60, 100, 120, 150, 240, 300, 350, 500, 600, 1000]; // ตัวอย่างไซส์มาตรฐาน 

 

// ========= Presets (เริ่มต้น — เพิ่มจากสเปกจริงได้) ========= 

// Optimal Audio: Up series (ceiling), Cuboid TX (surface) 

// HH: TNi series (ceiling), APT series (ceiling) — เพิ่ม/แก้ค่าตามสเปกจริงได้ 

const PRESETS={ 

  optimal:{label:'Optimal Audio',models:{ 

    // Up series (ตัวอย่างค่า) 

    'Up 3 (Ceiling)':{type:'ceiling',coverage:120,sens:86,taps:'1.5,3,6,12'}, 

    'Up 4 (Ceiling)':{type:'ceiling',coverage:120,sens:87,taps:'3.2,6.3,12.5,25'}, 

    'Up 6 (Ceiling)':{type:'ceiling',coverage:110,sens:90,taps:'7.5,15,30,60'}, 

    // Cuboid TX (เฉพาะ TX) — on-wall 

    'Cuboid 3TX (Surface)':{type:'surface',coverage:90,sens:86,taps:'7.5,15,30'}, 

    'Cuboid 5TX (Surface)':{type:'surface',coverage:90,sens:87,taps:'15,30,60'}, 

    'Cuboid 6TX (Surface)':{type:'surface',coverage:90,sens:88,taps:'15,30,60'} 

  }}, 

  hh:{label:'HH',models:{ 

    // TNi series (ceiling) 

    'TNi-C6 (Ceiling)':{type:'ceiling',coverage:120,sens:89,taps:'7.5,15,30,60'}, 

    'TNi-C8 (Ceiling)':{type:'ceiling',coverage:120,sens:91,taps:'10,20,40,60'}, 

    // APT series (ceiling) 

    'APT-C6 (Ceiling)':{type:'ceiling',coverage:120,sens:90,taps:'7.5,15,30,60'}, 

    'APT-C8 (Ceiling)':{type:'ceiling',coverage:120,sens:92,taps:'10,20,40,60'} 

  }} 

}; 

 

// เก็บ taps ปัจจุบันของรุ่น 

let currentModelTaps = []; 

 

// ========= UI: Brand/Model ========= 

function refreshModels(){ 

  const b=$('brand').value;const sel=$('model'); 

  sel.innerHTML='<option value="">— เลือกรุ่น —</option>'; 

  if(!b||!PRESETS[b]) return; 

  for(const k of Object.keys(PRESETS[b].models)){ 

    const o=document.createElement('option');o.value=k;o.textContent=k;sel.appendChild(o); 

  } 

} 

 

function populateTapSelectFromModel(preset){ 

  const tapSel = $('tapSelect'); tapSel.innerHTML = ''; 

  const optAuto = document.createElement('option'); optAuto.value = 'auto'; optAuto.textContent = 'Auto (แนะนำจากรุ่นนี้)'; tapSel.appendChild(optAuto); 

 

  currentModelTaps = []; 

  if(preset && preset.taps){ 

    currentModelTaps = String(preset.taps).split(/[,;]/) 

      .map(s=>sanitizeNum(s)).filter(v=>isFinite(v)).sort((a,b)=>a-b); 

  } 

  if(currentModelTaps.length){ 

    for(const t of currentModelTaps){ 

      const o=document.createElement('option'); o.value=String(t); o.textContent=`${t} W`; tapSel.appendChild(o); 

    } 

    $('tapCustomRow').style.display='none'; 

    tapSel.disabled = false; 

  }else{ 

    const o=document.createElement('option'); o.value='custom'; o.textContent='Custom…'; tapSel.appendChild(o); 

    tapSel.value='custom'; 

    $('tapCustomRow').style.display='grid'; 

  } 

} 

 

function applyModel(){ 

  const b=$('brand').value,m=$('model').value;if(!b||!m) return; 

  const p=PRESETS[b]?.models?.[m]; if(!p) return; 

 

  $('spkType').value=p.type||'ceiling'; 

  if(p.coverage!=null) $('coverage').value=p.coverage; 

  if(p.sens!=null) $('sens').value=p.sens; 

 

  populateTapSelectFromModel(p); 

  toggleTapCustom(); 

} 

 

// แสดง/ซ่อน custom tap 

function toggleTapCustom(){ 

  $('tapCustomRow').style.display = ($('tapSelect').value==='custom') ? 'grid' : 'none'; 

} 

 

// ดึงชุด taps ที่พร้อมใช้ ณ ตอนคำนวณ 

function getActiveTapArray(){ 

  const sel = $('tapSelect').value; 

  if(sel==='custom'){ 

    const raw = $('tapCustom').value||''; 

    return raw.split(/[,;]/).map(s=>sanitizeNum(s)).filter(v=>isFinite(v)).sort((a,b)=>a-b); 

  } 

  return currentModelTaps.slice(); 

} 

 

// ========= Core Calculator ========= 

function layout(){ 

  clearErr(); 

  const u=$('units').value; 

  const W=fromUnits(sanitizeNum($('roomW').value),u); 

  const L=fromUnits(sanitizeNum($('roomL').value),u); 

  const H=fromUnits(sanitizeNum($('roomH').value),u); 

  if([W,L,H].some(v=>!isFinite(v)||v<=0)){showErr('ใส่ค่ากว้าง/ยาว/สูง ให้ถูกต้อง');return;} 

 

  const lp=$('listenerPreset').value; 

  const listenerH=(lp==='standing')?1.5:(lp==='seated')?1.2:fromUnits(sanitizeNum($('listenerH').value)||1.2,u); 

 

  const sens=sanitizeNum($('sens').value), theta=sanitizeNum($('coverage').value); 

  if(!isFinite(sens)||!isFinite(theta)){showErr('ใส่ค่า Sensitivity/Coverage');return;} 

 

  // Base geometry (สำหรับกรณีทั่วไป/สำรอง) 

  const dVert=Math.max(0.6, H - listenerH); 

  const D=2*dVert*Math.tan(toRad(theta/2)); 

  const spacingBase=Math.max(0.1, D*0.7); 

 

  const type=$('spkType').value; 

  let pts=[];  

  let spacingShown=null; 

 

  if(type==='surface'){ 

    // --- Surface/On-wall: ผนังซ้าย–ขวาเท่านั้น, ห้ามกึ่งกลางห้อง/ผนังด้านกว้าง --- 

    // ระยะตามแนวยาว 4–6 m ตามความยาวห้อง 

    const minS=4, maxS=6; 

    const nLow=Math.ceil(L/maxS)+1; 

    const nHigh=Math.max(2, Math.floor(L/minS)+1); 

    let n=Math.max(2, Math.round(L/5)+1); 

    n=Math.min(Math.max(n, nLow), nHigh); 

    const spacingWall=(n>1)?(L/(n-1)):L; 

    spacingShown=spacingWall; 

 

    for(let i=0;i<n;i++){ 

      const y=i*spacingWall; 

      pts.push({x:0, y}); // ผนังซ้าย 

      pts.push({x:W, y}); // ผนังขวา 

    } 

  } 

  else if(type==='ceiling'){ 

    // --- Ceiling: 3 ระดับคุณภาพเสียง + Centering --- 

    let start, step; 

    const q=$('quality').value; 

    if(q==='high'){ start=H/2; step=H; } 

    else if(q==='mid'){ start=H; step=1.5*H; } 

    else { start=H; step=2*H; } // low/budget 

 

    // วางจุดแบบกริด (square/hex) จาก start/step และเว้นผนังตาม start 

    const lay=$('layout').value; 

    if(lay==='square'){ 

      const xs=[]; for(let x=start; x<=W-start+1e-9; x+=step){ xs.push(x); } 

      const ys=[]; for(let y=start; y<=L-start+1e-9; y+=step){ ys.push(y); } 

      if(xs.length===0){ xs.push(Math.min(W/2, Math.max(start, W-start))); } 

      if(ys.length===0){ ys.push(Math.min(L/2, Math.max(start, L-start))); } 

      for(const y of ys){ for(const x of xs){ pts.push({x, y}); } } 

 

      // Centering: จัดให้อยู่กึ่งกลางพื้นที่ห้อง (ภายในขอบ start..W-start / start..L-start) 

      const bounds = getBounds(pts); 

      const cx = (bounds.minX + bounds.maxX) / 2; 

      const cy = (bounds.minY + bounds.maxY) / 2; 

      const dx = (W/2 - cx); 

      const dy = (L/2 - cy); 

 

      // จำกัดการเลื่อนเพื่อไม่ให้ทะลุระยะเว้นผนัง 

      const minAllowedDx = (start - bounds.minX); 

      const maxAllowedDx = (W - start - bounds.maxX); 

      const minAllowedDy = (start - bounds.minY); 

      const maxAllowedDy = (L - start - bounds.maxY); 

      const dxClamped = clamp(dx, minAllowedDx, maxAllowedDx); 

      const dyClamped = clamp(dy, minAllowedDy, maxAllowedDy); 

 

      pts = pts.map(p=>({x:p.x+dxClamped, y:p.y+dyClamped})); 

      spacingShown = step; 

    }else{ 

      // hex layout: ระยะ step ใช้กับแกน x; ระยะระหว่างแถว = step*sqrt(3)/2 

      const s = step, dy = s*Math.sqrt(3)/2; 

      // สร้างแถวเริ่มที่ y=start จนถึง L-start 

      let y = start; 

      while (y <= L - start + 1e-9) { 

        // คอลัมน์ในแถวนั้น 

        const offsetX = (Math.round((y-start)/dy) % 2 === 1) ? s/2 : 0; 

        // หาคอลัมน์ตั้งแต่ start..W-start 

        let x = start + offsetX; 

        while (x <= W - start + 1e-9) { 

          pts.push({x, y}); 

          x += s; 

        } 

        y += dy; 

      } 

      if(pts.length===0){ 

        // สำรองกรณีห้องเล็กมาก 

        pts.push({x:clamp(W/2, start, W-start), y:clamp(L/2, start, L-start)}); 

      } 

 

      // Centering (เหมือน square) 

      const bounds = getBounds(pts); 

      const cx = (bounds.minX + bounds.maxX) / 2; 

      const cy = (bounds.minY + bounds.maxY) / 2; 

      const dx = (W/2 - cx); 

      const dy2 = (L/2 - cy); 

 

      const minAllowedDx = (start - bounds.minX); 

      const maxAllowedDx = (W - start - bounds.maxX); 

      const minAllowedDy = (start - bounds.minY); 

      const maxAllowedDy = (L - start - bounds.maxY); 

      const dxClamped = clamp(dx, minAllowedDx, maxAllowedDx); 

      const dyClamped = clamp(dy2, minAllowedDy, maxAllowedDy); 

 

      pts = pts.map(p=>({x:p.x+dxClamped, y:p.y+dyClamped})); 

      spacingShown = step; 

    } 

  } 

  else{ 

    // (เผื่อ) กริดทั่วไป: เว้นผนัง H รอบด้าน แล้วใช้ spacingBase 

    const wallMargin=H; 

    const usableW=W-2*wallMargin, usableL=L-2*wallMargin; 

    if(usableW<=0||usableL<=0){showErr('ห้องเล็ก/เพดานต่ำเกินไป');return;} 

    const lay=$('layout').value; 

    if(lay==='square'){ 

      const cols=Math.max(1, Math.ceil(usableW/spacingBase)); 

      const rows=Math.max(1, Math.ceil(usableL/spacingBase)); 

      const usedW=(cols-1)*spacingBase, usedL=(rows-1)*spacingBase; 

      const startX=wallMargin+Math.max(0,(usableW-usedW)/2); 

      const startY=wallMargin+Math.max(0,(usableL-usedL)/2); 

      for(let r=0;r<rows;r++) for(let c=0;c<cols;c++) pts.push({x:startX+c*spacingBase, y:startY+r*spacingBase}); 

      spacingShown=spacingBase; 

    }else{ 

      const s=spacingBase, dy=s*Math.sqrt(3)/2; 

      const hexRows=Math.max(1, Math.ceil(usableL/dy)); 

      const usedLhex=(hexRows-1)*dy, offY=wallMargin+Math.max(0,(usableL-usedLhex)/2); 

      for(let r=0;r<hexRows;r++){ 

        const offsetX=(r%2===1)?s/2:0; 

        const colsHex=Math.max(1, Math.ceil((usableW-offsetX)/s)); 

        const usedWhex=(colsHex-1)*s, offX=wallMargin+Math.max(0,(usableW-usedWhex)/2); 

        for(let c=0;c<colsHex;c++) pts.push({x:offX+offsetX+c*s, y:offY+r*dy}); 

      } 

      spacingShown=spacingBase; 

    } 

  } 

 

  // Tap: ใช้ชุดของรุ่นนั้นแบบไดนามิก 

  const tapsArr = getActiveTapArray(); 

  const tapSelVal = $('tapSelect').value; 

  const P_req = 1.5; // placeholder; ปรับสูตรตาม SPL Target ได้ภายหลัง 

 

  let chosenTap = null; 

  if(tapSelVal === 'auto'){ 

    chosenTap = nearestTap(P_req, tapsArr); 

  }else if(tapSelVal === 'custom'){ 

    chosenTap = nearestTap(P_req, tapsArr); 

  }else{ 

    const v = sanitizeNum(tapSelVal); 

    chosenTap = isFinite(v) ? v : nearestTap(P_req, tapsArr); 

  } 

 

  // รวมโหลดและแอมป์แนะนำ 

  const count = pts.length; 

  const totalW = (chosenTap!=null) ? (count * chosenTap) : null; 

  const ampRecommendedW = (totalW!=null) ? pickAmpSize(totalW * HEADROOM) : null; 

 

  // วาดและสรุป 

  drawRoom(W,L,pts,u,type); 

  $('kCount').textContent=count; 

  $('kSpacing').textContent=spacingShown?fmt(spacingShown,u):'-'; 

  $('kTap').textContent=(chosenTap!=null)?(chosenTap+' W'):'-'; 

  $('kTotalW').textContent=(totalW!=null)?(totalW.toFixed(1)+' W'):'-'; 

  $('kHeadroomPct').textContent = HEADROOM.toFixed(2)+'×'; 

  $('kAmpRec').textContent = (ampRecommendedW!=null)?(ampRecommendedW+' W (ขั้นต่ำ)'):'-'; 

 

  const modelText = $('model').value || '-'; 

  const typeText = $('spkType').value; 

  $('summary').innerHTML=`รุ่น <b>${modelText}</b> • ชนิด <b>${typeText}</b> • จุด <b>${count}</b>`; 

} 

 

function pickAmpSize(w){ 

  for(const s of AMP_STEPS){ if(s>=w-1e-6) return s; } 

  return Math.ceil(w/100)*100; // ถ้าเกิน list ให้ปัดขึ้นทีละ 100 W 

} 

 

function getBounds(pts){ 

  let minX=Infinity,maxX=-Infinity,minY=Infinity,maxY=-Infinity; 

  for(const p of pts){ if(p.x<minX)minX=p.x; if(p.x>maxX)maxX=p.x; if(p.y<minY)minY=p.y; if(p.y>maxY)maxY=p.y; } 

  return {minX,maxX,minY,maxY}; 

} 

function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); } 

 

function drawRoom(Wm,Lm,pts,u,type='ceiling'){ 

  const c=$('canvas'),ctx=c.getContext('2d'); 

  const dpi=window.devicePixelRatio||1; 

  c.width=c.clientWidth*dpi; c.height=c.clientHeight*dpi; ctx.setTransform(dpi,0,0,dpi,0,0); 

  ctx.clearRect(0,0,c.clientWidth,c.clientHeight); 

 

  const pad=30, w=c.clientWidth, h=c.clientHeight; 

  const sx=(w-2*pad)/Wm, sy=(h-2*pad)/Lm, s=Math.min(sx,sy); 

  const ox=(w - Wm*s)/2, oy=(h - Lm*s)/2; 

 

  // เส้นขอบห้อง 

  ctx.strokeStyle='#475569'; ctx.lineWidth=2; 

  ctx.strokeRect(ox, oy, Wm*s, Lm*s); 

 

  // เน้นผนังซ้าย/ขวาในโหมด surface (บอกให้รู้ว่าติดผนังเท่านั้น) 

  if(type==='surface'){ 

    ctx.fillStyle='rgba(59,130,246,0.12)'; 

    ctx.fillRect(ox-2, oy, 4, Lm*s);              // ซ้าย 

    ctx.fillRect(ox+Wm*s-2, oy, 4, Lm*s);         // ขวา 

  } 

 

  // จุดลำโพง 

  for(const p of pts){ 

    const x=ox+p.x*s, y=oy+p.y*s; 

    ctx.beginPath(); 

    if(type==='surface'){ 

      ctx.moveTo(x, y-6); ctx.lineTo(x+6,y+6); ctx.lineTo(x-6,y+6); ctx.closePath(); 

      ctx.fillStyle='#f59e0b'; ctx.fill(); 

    }else if(type==='pendant'){ 

      ctx.rect(x-5, y-5, 10, 10); ctx.fillStyle='#38bdf8'; ctx.fill(); 

    }else{ 

      ctx.arc(x, y, 5, 0, Math.PI*2); ctx.fillStyle='#38bdf8'; ctx.fill(); 

    } 

  } 

 

  // สเกล 

  ctx.fillStyle='#94a3b8'; ctx.font='14px sans-serif'; 

  ctx.fillText(`W: ${fmt(Wm,'m')}`, ox, oy-8); 

  ctx.save(); ctx.translate(ox-8, oy+12); ctx.rotate(-Math.PI/2); 

  ctx.fillText(`L: ${fmt(Lm,'m')}`, 0, 0); ctx.restore(); 

} 

 

// ========= events ========= 

$('brand').addEventListener('change', refreshModels); 

$('model').addEventListener('change', applyModel); 

$('listenerPreset').addEventListener('change', e=>{ 

  $('listenerCustomRow').style.display=(e.target.value==='custom')?'grid':'none'; 

}); 

$('tapSelect').addEventListener('change', toggleTapCustom); 

$('spkType').addEventListener('change', ()=>{ 

  // เปิด/ปิดตัวเลือกคุณภาพเมื่อสลับชนิดลำโพง 

  const dis = ($('spkType').value!=='ceiling'); 

  $('quality').disabled = dis; 

}); 

$('calcBtn').addEventListener('click', layout); 

$('clearBtn').addEventListener('click', ()=>{ 

  $('form').reset(); clearErr(); 

  currentModelTaps = []; 

  $('tapSelect').innerHTML='<option value="auto" selected>Auto (แนะนำจากรุ่นนี้)</option>'; 

  $('tapCustomRow').style.display='none'; 

  $('kCount').textContent='-'; $('kSpacing').textContent='-'; $('kTap').textContent='-'; $('kTotalW').textContent='-'; 

  $('kAmpRec').textContent='-'; $('summary').textContent=''; 

  drawRoom(12,18,[],'m'); 

}); 

drawRoom(12,18,[],'m'); 

</script> 

</body> 

</html> 
